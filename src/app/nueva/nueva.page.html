<ion-content class="ion-padding">
  <!-- Header Section -->
  <div class="header-section">
    <div class="user-info">
      <h1>Nueva Vizcaya</h1>
      <p class="email">
        <ion-icon name="person-circle-outline"></ion-icon>
        {{ userEmail }}
      </p>
    </div>
    <ion-button (click)="confirmLogout()">
      <ion-icon slot="start" name="log-out-outline"></ion-icon>
      Logout
    </ion-button>
  </div>

  <!-- Files Card -->
  <ion-card>
    <ion-card-header>
      <div class="card-header-flex">
        <ion-card-title>Files</ion-card-title>
        <div class="actions-group">
          <ion-button (click)="generateNewFile()">
            <ion-icon slot="start" name="add-outline"></ion-icon>
            Generate New File
          </ion-button>

          <div class="search-container">
            <ion-icon name="search-outline" class="search-icon"></ion-icon>
            <input 
              type="text" 
              class="search-input" 
              placeholder="Search files..."
              [(ngModel)]="searchQuery"
              (input)="onSearchChange()"
            />
            <ion-icon 
              *ngIf="searchQuery" 
              name="close-circle" 
              class="clear-icon"
              (click)="clearSearch()">
            </ion-icon>
          </div>
        </div>
      </div>
    </ion-card-header>
    
    <ion-card-content>
      <!-- Table View -->
      <div *ngIf="!loading && filteredFiles.length > 0" class="files-table">
        <!-- Table Header -->
        <div class="table-header">
          <div class="column-name">Name</div>
          <div class="column-owner">Owner</div>
          <div class="column-date">Date Created</div>
          <div class="column-actions"></div>
        </div>

        <!-- Table Body -->
        <div class="table-body">
          <div *ngFor="let file of filteredFiles" class="table-row">
            <div class="column-name">
              <ion-icon name="document-text-outline" class="file-icon"></ion-icon>
              <span class="file-name">{{ file.fileName }}</span>
            </div>
            <div class="column-owner">
              <ion-icon name="person-outline"></ion-icon>
              <span>{{ file.uploadedByEmail }}</span>
            </div>
            <div class="column-date">
              <ion-icon name="calendar-outline"></ion-icon>
              <span>{{ formatDate(file.uploadedAt) }}</span>
            </div>
            <div class="column-actions">
              <ion-icon 
                name="ellipsis-vertical" 
                class="options-icon"
                (click)="openFileOptions(file)">
              </ion-icon>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!loading && filteredFiles.length === 0 && !searchQuery" class="empty-state">
        <ion-icon name="folder-open-outline"></ion-icon>
        <p>No files yet</p>
      </div>

      <div *ngIf="!loading && filteredFiles.length === 0 && searchQuery" class="empty-state">
        <ion-icon name="search-outline"></ion-icon>
        <p>No files found matching "{{ searchQuery }}"</p>
        <ion-button fill="outline" (click)="clearSearch()">
          Clear Search
        </ion-button>
      </div>

      <div *ngIf="loading" class="loading-state">
        <ion-icon name="hourglass-outline"></ion-icon>
        <p>Loading files...</p>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>